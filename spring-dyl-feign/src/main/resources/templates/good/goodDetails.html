<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <!-- 引入bootstrap的css -->
    <link href="/js/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <!-- 引入bootstrap-treeview的css -->
    <link href="/js/bootstrap/treeview/bootstrap-treeview.min.css" rel="stylesheet">
    <!-- 引入bootstrap-addTabs的css -->
    <link href="/js/bootstrap/addTabs/addTabs.css" rel="stylesheet">
    <!-- 引入bootstrap-table的css -->
    <link href="/js/bootstrap/table/bootstrap-table.min.css" rel="stylesheet">
    <!-- 引入fileinput的css -->
    <link href="/js/bootstrap/fileinput/css/fileinput.min.css" rel="stylesheet"/>
    <!-- 引入bootstrap-datetimepicker的css-->
    <link href="/js/bootstrap/datetimepicker/css/bootstrap-datetimepicker.css" rel="stylesheet">

    <!-- 引入jquery -->
    <script type="text/javascript" src="/js/jquery-1.11.3.min.js"></script>
    <!-- 引入my97 -->
    <script type="text/javascript" src="/js/my97/WdatePicker.js"></script>
    <!-- 引入bootstrap的js-->
    <script type="text/javascript" src="/js/bootstrap/bootstrap.min.js"></script>
    <!-- 引入bootstrap的js-->
    <script type="text/javascript" src="/js/bootstrap/treeview/bootstrap-treeview.min.js"></script>
    <!-- 引入bootstrap的js-->
    <script type="text/javascript" src="/js/bootstrap/addTabs/addTabs.js"></script>
    <!-- 引入bootstrap-table的js-->
    <script type="text/javascript" src="/js/bootstrap/table/bootstrap-table.min.js"></script>
    <script type="text/javascript" src="/js/bootstrap/table/locale/bootstrap-table-zh-CN.min.js"></script>
    <!-- 引入bootbox.js -->
    <script type="text/javascript" src="/js/bootstrap/bootbox/bootbox.js"></script>
    <!-- 引入fileinput的js -->
    <script type="text/javascript" src="/js/bootstrap/fileinput/js/fileinput.min.js"></script>
    <!-- 引入fileinput当地语言的js -->
    <script type="text/javascript" src="/js/bootstrap/fileinput/js/locales/zh.js"></script>
    <!-- 引入fileinput主题的js -->
    <script type="text/javascript" src="/js/bootstrap/fileinput/themes/fa/theme.js"></script>
    <!-- 引入datetimepicker的js-->
    <script type="text/javascript" src="/js/bootstrap/datetimepicker/js/bootstrap-datetimepicker.js"></script>
    <script type="text/javascript" src="/js/bootstrap/datetimepicker/js/locales/bootstrap-datetimepicker.zh-CN.js"></script>
</head>
<body>
    <table id="bookTable"></table>
</body>
<script>
    $(function(){
        search();
    })
    function search(){
        $('#bookTable').bootstrapTable('destroy');
        $("#bookTable").bootstrapTable({
        url:"/good/queryGood",
        method:"post",			     //请求方式（*）
        striped: true,  	         //斑马线效果     默认false
        singleSelect:true,          //只允许选中一行
        showToggle:true,            //是否显示详细视图和列表视图的切换按钮（table/card）按钮
        cardView: false,            //是否显示详细视图
        uniqueId: "goodId",         //每一行的唯一标识，一般为主键列
        showColumns: true,          //是否显示所有的列
        showRefresh: true,          //是否显示刷新按钮
        showPaginationSwitch:false, //是否显示 数据条数选择框
        detailView:false,           //设置为 true 可以显示详细页面模式。
        showFooter:false,           //是否显示列脚
        clickToSelect:true,         //是否启用点击选中行
        minimumCountColumns: 2,     //最少留两列
        //sortName:'goodId', 	    //排序字段
        //sortOrder:'desc',         //排序方式
        search:true,                //前台--搜索框
        searchText:'请输入内容',     //初始化搜索文字
        searchOnEnterKey:true,      //启动回车键做搜索功能
        sidePagination:'server',    //后台请求的分页方式
        pagination: true,           //是否显示分页（*）
        paginationShowPageGo:true,  //显示跳转页码按钮
        pageNum: 1,                 //每页的记录行数（*）
        pageSize: 3,                //每页的记录行数（*）
        pageList: [3, 6, 9,12],     //可供选择的每页的行数（*）
        toolbar:'#tabToolBar',      //工具定义位置
        contentType:'application/x-www-form-urlencoded;charset=UTF-8',  //发送到服务器的数据编码类型
        columns:[
            {field:'goodId',title:'多选',width:50,
                formatter:function(value,row,index){
                    return "<input type='checkbox' value="+value+" name='chk'/>";
                }
            },
            {field:'goodName',title:'商品名称',width:100},
            {field:'showClassify',title:'商品分类',width:100},
            {field:'goodSketch',title:'商品简介',width:100},
            {field:'goodImg',title:'商品图片',width:100,
                formatter:function(value,row,index){
                    return "<img class='img-responsive img-rounded' width='150px' heigth='150px' src='../good/getGoodImg?id="+value+"'>";
                }
            },
            {field:'showSpecification',title:'商品规格',width:100,
                formatter:function(value,row,index){
                        return value.tname;
                }
            },
            {field:'createTime',title:'出版时间',width:100
                /* formatter:function(value,row,index){//value 当前字段值  row当前行的数据  index当前行
                var simfomat = new Date();
                simfomat.setTime(value);   //转换时间
                return  simfomat.toLocaleDateString();
                } */
            },

            {field:'videoId',title:'书籍视频',width:100,
                formatter:function(value,row,index){
                return "<video width='200px' height='150px' src='<%=request.getContextPath()%>/book/getImg.do?id="+value+"' controls='controls'></video><button type='button' class='btn btn-danger' onclick='getVideo(\""+row.videoId+"\",\""+row.imgId+"\")'>查看视频详情</button>";
                }
            },
            {field:'caozuo',title:'操作',align:'center',width:100,
                formatter:function(value,row,index){
                var a = '<button type="button" class="btn btn-danger glyphicon glyphicon-remove" onclick="delBook(\''+row.bookId+'\')">删除</button>';
                var b = '<button type="button" class="btn btn-info glyphicon glyphicon-pencil" onclick="updBook(\''+row.bookId+'\')">修改</button>';
                return a+'&nbsp;&nbsp;&nbsp;&nbsp;'+b;
                }
            },
        ],
        //传递参数（*）
        queryParams: function(params) {
            var whereParams = {
            /*
            分页  自定义的参数         默认传 limit（展示几条）    offset（从第几条开始    起始条数）
            */
            pageSize:params.limit,
            start:params.offset,
            bookName:$("#bookName").val(),
            minTime:$("#minTime").val(),
            maxTime:$("#maxTime").val(),
            //"pro_name":params.search,//精确搜索产品名称
            }
            return whereParams;
            },

        })
    }
function getJspHtml(urlStr){
    var  jspHtml = "";
    //	 async  (默认: true) 默认设置下，所有请求均为异步请求。如果需要发送同步请求，请将此选项设置为 false。
    //注意，同步请求将锁住浏览器，用户其它操作必须等待请求完成才可以执行。
    $.ajax({
        url:urlStr,
        type:'post',
        //同步的ajax
        async:false,
        success:function(data){
        //alert(data);//data--addProduct.jsp页面内容
        jspHtml = data;
        },
        error:function(){
        bootbox.alert("ajax失败");
        }
    });
    return jspHtml;
}

function  dialog(HTMLurl,submitUrl,title){

    var dialog = bootbox.dialog({
    title: title,
    message: getJspHtml(HTMLurl),   //调用方法
    buttons:{
        "save":{
        label: '保存',
        animate: true,
        className: "btn-success",
        callback: function() {
        $.ajax({
            url:submitUrl,
            type:'post',
            data:$("#bookForm").serialize(),
            success:function(data){
            bootbox.alert("保存成功");
            $("#bookTable").bootstrapTable('refresh');
            },
            error:function(){
            bootbox.alert("ajax失败");
            }
        });
        }
    },
        "unSave":{
            label: '取消',
            //自定义样式
            className: "btn-info",
            callback: function() {
            // return false;  //dialog不关闭
            }
        }
    }
    });
}


function getVideo(vid,id){
    dialog("<%=request.getContextPath()%>/book/getVideo.do?videoId="+vid+"&&imgId="+id,"<%=request.getContextPath()%>/book/editBook.do","ckplayer");
}

function addMany(){
    dialog("<%=request.getContextPath()%>/book/toAddMany.do","<%=request.getContextPath()%>/book/addMany.do","批量新增")
}

function addBook(){
    dialog("<%=request.getContextPath()%>/book/toAddBook.do","<%=request.getContextPath()%>/book/editBook.do","单个新增")
}

function updBook(id){
    dialog("<%=request.getContextPath()%>/book/toUpdBook.do?bookId="+id,"<%=request.getContextPath()%>/book/editBook.do","修改")
}

function delBook(id){
    if (confirm("您确定要删除吗")) {
        $.ajax({
            url:'<%=request.getContextPath()%>/book/delBook.do',
            type:'post',
            data:{bookId:id},
            dataType:'json',
            success:function(data){
                $('#bookTable').bootstrapTable('refresh');
            }
        });
    }
}

$('.date').datetimepicker({
    language: 'zh-CN',//显示中文
    format: 'yyyy-mm-dd',//显示格式hh:ii:ss
    minView: "month",//设置只显示到月份
    initialDate: new Date(),//初始化当前日期
    autoclose: true,//选中自动关闭
    todayBtn: true//显示今日按钮
})
</script>
</html>